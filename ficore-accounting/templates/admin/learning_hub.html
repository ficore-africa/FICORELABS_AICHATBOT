{% extends 'admin/base.html' %}
{% block content %}
<div class="container">
    <h1>{{ t('admin_manage_learning_hub_title', default='Manage Learning Hub') | escape }}</h1>
    <div class="card mb-4">
        <div class="card-header">{{ t('learning_hub_add_content', default='Add New Content') | escape }}</div>
        <div class="card-body">
            <form method="POST" enctype="multipart/form-data" action="{{ url_for('admin.admin_learning_hub') }}">
                {{ form.hidden_tag() }}
                <div class="form-group mb-3">
                    {{ form.title.label }} {{ form.title }}
                    {% if form.title.errors %}
                        <div class="text-danger">
                            {% for error in form.title.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-group mb-3">
                    {{ form.description.label }} {{ form.description }}
                    {% if form.description.errors %}
                        <div class="text-danger">
                            {% for error in form.description.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-group mb-3">
                    {{ form.content_type.label }} {{ form.content_type }}
                    {% if form.content_type.errors %}
                        <div class="text-danger">
                            {% for error in form.content_type.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-group mb-3">
                    {{ form.roles.label }} {{ form.roles }}
                    {% if form.roles.errors %}
                        <div class="text-danger">
                            {% for error in form.roles.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-group mb-3">
                    {{ form.is_premium.label }} {{ form.is_premium }}
                    {% if form.is_premium.errors %}
                        <div class="text-danger">
                            {% for error in form.is_premium.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                <div class="form-group mb-3" id="file-upload" style="display: none;">
                    <label for="file">{{ t('learning_hub_upload_file', default='Upload File') | escape }}</label>
                    <input type="file" name="file" class="form-control" accept=".mp4,.pdf,.txt,.md">
                    {% if form.file and form.file.errors %}
                        <div class="text-danger">
                            {% for error in form.file.errors %}
                                {{ error | escape }}
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>
                {{ form.submit }}
            </form>
        </div>
    </div>

    <h2>{{ t('learning_hub_contents', default='Learning Hub Contents') | escape }}</h2>
    {% if contents %}
    <div class="table-responsive">
        <table class="table table-striped table-bordered">
            <thead class="table-light">
                <tr>
                    <th>{{ t('learning_hub_content_title', default='Title') | escape }}</th>
                    <th>{{ t('learning_hub_content_type', default='Type') | escape }}</th>
                    <th>{{ t('learning_hub_roles', default='Roles') | escape }}</th>
                    <th>{{ t('learning_hub_is_premium', default='Premium') | escape }}</th>
                    <th>{{ t('admin_created_at', default='Created At') | escape }}</th>
                    <th>{{ t('general_actions', default='Actions') | escape }}</th>
                </tr>
            </thead>
            <tbody>
                {% for content in contents %}
                <tr>
                    <td>{{ content.title_en | escape }}</td>
                    <td>{{ content.modules[0].lessons[0].content_type | escape }}</td>
                    <td>{{ content.roles | join(', ') | escape }}</td>
                    <td>{{ 'Yes' if content.is_premium else 'No' | escape }}</td>
                    <td>{{ content.created_at | datetimeformat | escape }}</td>
                    <td>
                        <a href="{{ url_for('admin.edit_learning_hub_content', content_id=content._id) }}" class="btn btn-sm btn-primary">{{ t('general_edit', default='Edit') | escape }}</a>
                        <form action="{{ url_for('admin.delete_learning_hub_content', content_id=content._id) }}" method="POST" style="display:inline;">
                            <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('{{ t('general_confirm_delete', default='Are you sure you want to delete this item?') | escape }}')">{{ t('general_delete', default='Delete') | escape }}</button>
                        </form>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
    {% else %}
    <p class="text-muted">{{ t('learning_hub_no_content', default='No content available') | escape }}</p>
    {% endif %}
    <a href="{{ url_for('admin.dashboard') }}" class="btn btn-secondary mt-3">{{ t('general_back_to_dashboard', default='Back to Dashboard') | escape }}</a>
</div>
<script>
    document.getElementById('content_type').addEventListener('change', function() {
        const fileUpload = document.getElementById('file-upload');
        fileUpload.style.display = this.value === 'video' || this.value === 'pdf' ? 'block' : 'none';
    });
    // Set initial file upload visibility based on form value
    document.addEventListener('DOMContentLoaded', function() {
        const contentType = document.getElementById('content_type').value;
        const fileUpload = document.getElementById('file-upload');
        fileUpload.style.display = contentType === 'video' || contentType === 'pdf' ? 'block' : 'none';
    });
</script>
{% endblock %}
